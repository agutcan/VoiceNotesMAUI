<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VoiceNotesMAUI.MVVM.Views.MainPage"
             BackgroundColor="{StaticResource ColorFondo}">

    <Grid RowDefinitions="Auto, Auto, *" Margin="0">

        <VerticalStackLayout Grid.Row="0" Padding="30,40,30,10" Spacing="5">
            <Label Text="📝 COLECCIÓN" FontSize="12" TextColor="{StaticResource ColorPrimario}"
                   FontAttributes="Bold" CharacterSpacing="2" />
            <Label Text="Mis notas" FontSize="36" FontAttributes="Bold" TextColor="{StaticResource ColorTexto}" />
        </VerticalStackLayout>

        <Border Grid.Row="1" Margin="30,10,30,20" StrokeThickness="0" BackgroundColor="{StaticResource ColorTarjeta}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="12" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Offset="0,2" Radius="8" Opacity="0.1" Brush="Black" />
            </Border.Shadow>

            <SearchBar Placeholder="🔍 Busca por contenido de nota..." 
                PlaceholderColor="Gray"
                Text="{Binding FiltroTexto}"
                FontSize="15" 
                TextColor="{StaticResource ColorTexto}"
                BackgroundColor="Transparent" 
                CancelButtonColor="{StaticResource ColorPrimario}" />
        </Border>

        <Grid Grid.Row="2">
            <CollectionView ItemsSource="{Binding NotasFiltradas}" SelectionMode="Single"
                            SelectionChanged="OnNotaSeleccionada" Margin="30,0">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeThickness="0" Padding="20,15" BackgroundColor="{StaticResource ColorTarjeta}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="15" />
                            </Border.StrokeShape>
                            <Border.Shadow>
                                <Shadow Offset="0,4" Radius="10" Opacity="0.05" Brush="Black" />
                            </Border.Shadow>

                            <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                                <VerticalStackLayout Grid.Column="0" Spacing="5" VerticalOptions="Center">
                                    <Label Text="{Binding Texto}" 
                                       FontSize="16" 
                                       TextColor="{StaticResource ColorTexto}"
                                       MaxLines="1" 
                                       LineBreakMode="TailTruncation" />
                                                            <Label Text="Toca para escuchar" 
                                       FontSize="12" 
                                       TextColor="{StaticResource ColorPrimario}" 
                                       FontAttributes="Italic" />
                                </VerticalStackLayout>

                                <Button Grid.Column="1"
                                    Text="✕"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    TextColor="#FF4C4C"
                                    BackgroundColor="#FFF0F0"
                                    HeightRequest="36"
                                    WidthRequest="36"
                                    CornerRadius="18"
                                    Padding="0"
                                    VerticalOptions="Center"
                                    HorizontalOptions="End"
                                    Clicked="OnEliminarNota"
                                    CommandParameter="{Binding .}" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.Footer>
                    <BoxView HeightRequest="100" Color="Transparent" />
                </CollectionView.Footer>
            </CollectionView>

            <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="15"
                                 IsVisible="{Binding SinNotasFiltradas}">
                <Label Text="🔍" FontSize="60" HorizontalOptions="Center" />
                <Label Text="No encontramos notas" FontSize="16" TextColor="Gray" HorizontalOptions="Center" />
            </VerticalStackLayout>
        </Grid>

        <Border Grid.Row="2" 
                HeightRequest="64" 
                WidthRequest="64" 
                HorizontalOptions="End" 
                VerticalOptions="End" 
                Margin="40" 
                StrokeThickness="0" 
                BackgroundColor="{StaticResource ColorPrimario}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="32" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Offset="0,8" Radius="15" Opacity="0.3" Brush="Black" />
            </Border.Shadow>
            <Grid>
                <Label Text="+" 
                       FontSize="34" 
                       TextColor="White" 
                       HorizontalOptions="Center" 
                       VerticalOptions="Center" 
                       Margin="0,0,0,4" />
                <ImageButton BackgroundColor="Transparent" Clicked="OnAgregarNota" />
            </Grid>
        </Border>
    </Grid>
</ContentPage>